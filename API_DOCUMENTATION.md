# Lasers Drawbridge WebApp API Documentation

## –û–±–∑–æ—Ä

–≠—Ç–æ API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–∞–∑–µ—Ä–Ω—ã–º–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π real-time –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ long-polling. –°–∏—Å—Ç–µ–º–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∫–æ–º–∞–Ω–¥—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º –∏ –ø–æ–ª—É—á–∞—Ç—å —Å–æ–±—ã—Ç–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º
- Long-polling –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–∞–∫—Ä–æ—Å—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã–∫–ª—é—á–µ–Ω–∏—è)
- –•—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–±—ã—Ç–∏–π –≤ SQLite
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

### –ë–∞–∑–æ–≤—ã–π URL
```
http://localhost:8080/api/v1
```

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –¥–≤–∞ —Ä–µ–∂–∏–º–∞:

1. Legacy —Ç–æ–∫–µ–Ω (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å):
```
Authorization: Bearer <AUTH_TOKEN>
```
2. JWT —Ç–æ–∫–µ–Ω (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
```
Authorization: Bearer <JWT_TOKEN>
```

JWT –≤—ã–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ —ç–Ω–¥–ø–æ–∏–Ω—Ç `/api/v1/auth/login` –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç: `userId`, `username`, `email`, `role`. –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 24 —á–∞—Å–∞ (`JWT_EXPIRES_IN`).

---

## –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã API

### 1. Long-Polling –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–π

**GET** `/api/v1/poll`

–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –æ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º long-polling.

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:
- `device` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) - ID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- `cursor` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - ID –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ —Å–æ–±—ã—Ç–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 0)
- `wait` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (–æ—Ç 5 –¥–æ 60, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 25)

#### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:
```
GET /api/v1/poll?device=laser001&cursor=123&wait=30
```

#### –û—Ç–≤–µ—Ç—ã:
**200 OK** - –ï—Å—Ç—å –Ω–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è:
```json
{
  "events": [
    {
      "id": 124,
      "ts": "2025-09-30T10:30:00.000Z",
      "cmd": "SCENE 1",
      "val": 1
    }
  ],
  "cursor": "124"
}
```

**204 No Content** - –ù–µ—Ç –Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π –≤ —Ç–µ—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –æ–∂–∏–¥–∞–Ω–∏—è

**400 Bad Request** - –û—à–∏–±–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:
```json
{
  "ok": false,
  "error": "device required"
}
```

---

### 2. –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥ —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É

**POST** `/api/v1/cmd` üîí *–¢—Ä–µ–±—É–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏*

–û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã –∏–ª–∏ –Ω–∞–±–æ—Ä–∞ –∫–æ–º–∞–Ω–¥ —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É.

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:
- `device` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) - ID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

#### –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:
–ú–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å:
1. –û–¥–Ω—É –∫–æ–º–∞–Ω–¥—É –∫–∞–∫ –æ–±—ä–µ–∫—Ç
2. –ú–∞—Å—Å–∏–≤ –∫–æ–º–∞–Ω–¥
3. –û–±—ä–µ–∫—Ç —Å –ø–æ–ª–µ–º `events`, —Å–æ–¥–µ—Ä–∂–∞—â–∏–º –º–∞—Å—Å–∏–≤ –∫–æ–º–∞–Ω–¥

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–º–∞–Ω–¥—ã:
```json
{
  "cmd": "–ù–ê–ó–í–ê–ù–ò–ï_–ö–û–ú–ê–ù–î–´",
  "args": "–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)",
  "val": "–∑–Ω–∞—á–µ–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)", 
  "num": "—á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)",
  "raw": "—Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)"
}
```

#### –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:

**–û–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞:**
```json
{
  "cmd": "SCENE 1",
  "val": 1
}
```

**–ù–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–º–∞–Ω–¥:**
```json
{
  "events": [
    {
      "cmd": "SCENE 1",
      "val": 1
    },
    {
      "cmd": "RAW",
      "raw": "40 0"
    }
  ]
}
```

**–ú–∞—Å—Å–∏–≤ –∫–æ–º–∞–Ω–¥ –Ω–∞–ø—Ä—è–º—É—é:**
```json
[
  {
    "cmd": "SCENE 2",
    "val": 2
  },
  {
    "cmd": "OFF"
  }
]
```

#### –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:

##### OFF - –ú–∞–∫—Ä–æ—Å –≤—ã–∫–ª—é—á–µ–Ω–∏—è
–ö–æ–º–∞–Ω–¥–∞ `OFF` –∑–∞–ø—É—Å–∫–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã–∫–ª—é—á–µ–Ω–∏—è:
1. **t=0s**: `SCENE 1` (val: 1)
2. **t=20s**: RAW `1 0`
3. **t=40s**: RAW `40 0` 
4. **t=60s**: RAW `50 0`
5. **t=80s**: `OFF`

#### –û—Ç–≤–µ—Ç:
**200 OK**:
```json
{
  "ok": true,
  "added": [
    {
      "id": 125,
      "ts": "2025-09-30T10:35:00.000Z",
      "cmd": "SCENE 1",
      "val": 1
    }
  ],
  "macro": "OFF_SEQUENCE"
}
```

**400 Bad Request**:
```json
{
  "ok": false,
  "error": "device required"
}
```

**401 Unauthorized**:
```json
{
  "ok": false,
  "error": "unauthorized"
}
```

---

### 2.2 –ü—Ä–∏—ë–º —Å—Ç–∞—Ç—É—Å–∞ –ª–∞–∑–µ—Ä–∞ –æ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

**POST** `/api/v1/device/:id/state`

–≠—Ç–æ—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–≤–æ–µ–≥–æ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è (–º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å –ø–æ–∑–∂–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏).

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—É—Ç–∏:
- `id` ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

#### –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:
```json
{
  "state": "OK" | "DEVIATION",
  "deviation": 0.0
}
```

–ü–æ–ª–µ `deviation` –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ. –ï—Å–ª–∏ `state` = `DEVIATION`, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è.

#### –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç:
```json
{
  "ok": true,
  "event": {
    "id": 321,
    "ts": "2025-10-06T10:15:00.000Z",
    "cmd": "STATUS",
    "state": "OK",
    "deviation": 0
  }
}
```

#### –û—à–∏–±–∫–∏:
- `400` ‚Äî –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç `device` –∏–ª–∏ `state`, –ª–∏–±–æ –Ω–µ–≤–µ—Ä–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `state`
- `500` ‚Äî –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

---

### 2.1 –£–ø—Ä–æ—â—ë–Ω–Ω—ã–µ (convenience) —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∫–æ–º–∞–Ω–¥

–î–ª—è —Ç–∏–ø–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –¥–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ—Ä–æ—Ç–∫–∏–µ –º–∞—Ä—à—Ä—É—Ç—ã:

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------|------|------------|
| POST | /api/v1/device/:id/off | –ó–∞–ø—É—Å—Ç–∏—Ç—å OFF –º–∞–∫—Ä–æ—Å (SCENE 1 ‚Üí RAW 1 0 ‚Üí RAW 40 0 ‚Üí RAW 50 0 ‚Üí OFF) |
| POST | /api/v1/device/:id/scene/1 | –û—Ç–ø—Ä–∞–≤–∏—Ç—å SCENE 1 |
| POST | /api/v1/device/:id/scene/2 | –û—Ç–ø—Ä–∞–≤–∏—Ç—å SCENE 2 |
| POST | /api/v1/device/:id/custom | –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ–¥–Ω—É –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—É—é –∫–æ–º–∞–Ω–¥—É |

#### –ü—Ä–∏–º–µ—Ä—ã:

```bash
curl -X POST -H "Authorization: Bearer <TOKEN>" \
  http://localhost:8080/api/v1/device/laser001/off

curl -X POST -H "Authorization: Bearer <TOKEN>" \
  http://localhost:8080/api/v1/device/laser001/scene/1

curl -X POST -H "Authorization: Bearer <TOKEN>" -H 'Content-Type: application/json' \
  -d '{"cmd":"SCENE","val":2}' \
  http://localhost:8080/api/v1/device/laser001/custom
```

–ö–æ–≥–¥–∞ `cmd=OFF` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `/custom`, —Å–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç —ç—Ç–æ –≤ –º–∞–∫—Ä–æ—Å OFF.

---

### 3. –°–ø–∏—Å–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤

**GET** `/api/v1/devices` üîí *–¢—Ä–µ–±—É–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏*

–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —Å –∏—Ö —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π.

#### –û—Ç–≤–µ—Ç:
```json
{
  "devices": [
    {
      "id": "laser001",
      "lastSeenAt": 1727692200000,
      "queueLen": 5,
      "lastId": 150,
      "lastEventAt": "2025-09-30T10:30:00.000Z",
      "scheduleHas": true,
      "scheduleActive": false
    },
    {
      "id": "laser002", 
      "lastSeenAt": 1727692100000,
      "queueLen": 2,
      "lastId": 89,
      "lastEventAt": "2025-09-30T10:28:00.000Z",
      "scheduleHas": false,
      "scheduleActive": false
    }
  ]
}
```

#### –ü–æ–ª—è –æ—Ç–≤–µ—Ç–∞:
- `id` - ID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- `lastSeenAt` - –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏—è –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö (timestamp)
- `queueLen` - —Ä–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏ —Å–æ–±—ã—Ç–∏–π –≤ –ø–∞–º—è—Ç–∏
- `lastId` - ID –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–±—ã—Ç–∏—è
- `lastEventAt` - –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–±—ã—Ç–∏—è (ISO string)
- `scheduleHas` - –µ—Å—Ç—å –ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –ø—Ä–∞–≤–∏–ª–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (–≤ —Ç.—á. wildcard)
- `scheduleActive` - —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —Å–µ–π—á–∞—Å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∞–∫—Ç–∏–≤–Ω–æ–º –æ–∫–Ω–µ (–∫–∞–∫–∞—è-–ª–∏–±–æ SCENE –±—É–¥–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å—Å—è)
- (–ø—Ä–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–∏ —á–µ—Ä–µ–∑ Device –º–æ–¥–µ–ª—å –º–æ–∂–Ω–æ –æ–±–æ–≥–∞—â–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ ‚Äî —Å–º. —Ä–∞–∑–¥–µ–ª "–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏")

---

### 4. –ò—Å—Ç–æ—Ä–∏—è —Å–æ–±—ã—Ç–∏–π —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

**GET** `/api/v1/events` üîí *–¢—Ä–µ–±—É–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏*

–ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:
- `device` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) - ID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- `cursor` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - ID —Å–æ–±—ã—Ç–∏—è, –ø–æ—Å–ª–µ –∫–æ—Ç–æ—Ä–æ–≥–æ –ø–æ–ª—É—á–∞—Ç—å —Å–æ–±—ã—Ç–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 0)
- `limit` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–±—ã—Ç–∏–π (–æ—Ç 1 –¥–æ 500, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 100)

#### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:
```
GET /api/v1/events?device=laser001&cursor=100&limit=50
```

#### –û—Ç–≤–µ—Ç:
```json
{
  "events": [
    {
      "id": 101,
      "ts": "2025-09-30T10:25:00.000Z",
      "cmd": "SCENE 1",
      "val": 1
    },
    {
      "id": 102,
      "ts": "2025-09-30T10:26:00.000Z", 
      "cmd": "RAW",
      "raw": "40 0"
    }
  ],
  "cursor": "102"
}
```

---

### 5. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (JWT)

**POST** `/api/v1/auth/login`

–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ `username`/`email` –∏ –ø–∞—Ä–æ–ª—é. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JWT —Ç–æ–∫–µ–Ω.

#### –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:
```json
{
  "login": "admin", // username –∏–ª–∏ email
  "password": "secret123"
}
```

#### –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç:
```json
{
  "ok": true,
  "token": "<JWT_TOKEN>",
  "user": {
    "id": 1,
    "username": "admin",
    "email": "admin@example.com",
    "role": "superadmin"
  }
}
```

#### –û—à–∏–±–∫–∏:
`400` ‚Äî –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø–æ–ª—è; `401` ‚Äî –Ω–µ–≤–µ—Ä–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

### 6. –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

**GET** `/api/v1/auth/me` üîí

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Ç–µ–∫—É—â–µ–≥–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ JWT.

#### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
```json
{
  "ok": true,
  "user": {
    "id": 1,
    "username": "admin",
    "email": "admin@example.com",
    "role": "superadmin",
    "lastLoginAt": "2025-09-30T07:20:11.000Z"
  }
}
```

### 7. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**POST** `/api/v1/users` üîí *(—Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è ‚Äî —Å–æ–∑–¥–∞—ë—Ç –∞–¥–º–∏–Ω / —Å—É–ø–µ—Ä-–∞–¥–º–∏–Ω)*

#### –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:
```json
{
  "username": "user1",
  "email": "user1@example.com",
  "password": "Passw0rd!",
  "role": "admin" // –∏–ª–∏ "superadmin"
}
```

#### –û—Ç–≤–µ—Ç:
```json
{
  "ok": true,
  "user": {
    "id": 2,
    "username": "user1",
    "email": "user1@example.com",
    "role": "admin",
    "isActive": true,
    "createdAt": "2025-09-30T07:30:00.000Z"
  }
}
```

### 8. –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**GET** `/api/v1/users?includeInactive=true` üîí

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –ï—Å–ª–∏ `includeInactive=true` ‚Äî –≤–∫–ª—é—á–∞–µ—Ç –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö.

### 9. –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**GET** `/api/v1/users/:id` üîí

### 10. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**PUT** `/api/v1/users/:id` üîí

#### –ü—Ä–∏–º–µ—Ä —Ç–µ–ª–∞:
```json
{ "email": "new@example.com", "role": "admin", "isActive": true }
```

### 11. –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è

**POST** `/api/v1/users/:id/change-password` üîí
```json
{ "currentPassword": "oldPass1", "newPassword": "NewPass2" }
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–π –ø–∞—Ä–æ–ª—å, –∫—Ä–æ–º–µ —Ä–æ–ª–∏ `superadmin`.

### 12. –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**DELETE** `/api/v1/users/:id` üîí
Soft delete ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–º–µ—á–∞–µ—Ç—Å—è `isActive=false`.

---

### 13. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ (–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã)

Prisma –º–æ–¥–µ–ª—å `Device` (–∞–∫—Ç—É–∞–ª—å–Ω–∞—è):
```prisma
model Device {
  id         String   @id
  lat        Float?
  lon        Float?
  lastSeenAt DateTime @default(now())
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  events     Event[]
}
```

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------|------|------------|
| GET | /api/v1/devices | –°–ø–∏—Å–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ + –ø–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å + –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã |
| GET | /api/v1/device/:id | –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–¥–µ–Ω–∏—è –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ (lat/lon, lastSeenAt, lastEvent) |
| PUT | /api/v1/device/:id | –°–æ–∑–¥–∞—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (lat, lon) |
| GET | /api/v1/devices/coords | –£–ø—Ä–æ—â—ë–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ (id, lat, lon, lastSeenAt) –¥–ª—è –∫–∞—Ä—Ç |

–¢–µ–ª–æ PUT –∑–∞–ø—Ä–æ—Å–∞:
```json
{ "lat": 55.751244, "lon": 37.618423 }
```

–û—Ç–≤–µ—Ç:
```json
{
  "ok": true,
  "device": {
    "id": "laser001",
    "lat": 55.751244,
    "lon": 37.618423,
    "lastSeenAt": "2025-09-30T10:40:00.000Z",
    "createdAt": "2025-09-30T09:00:00.000Z",
    "updatedAt": "2025-09-30T10:40:05.000Z",
    "scheduleHas": true,
    "scheduleActive": true
  }
}
```

–ó–∞–º–µ—á–∞–Ω–∏—è:
- –ü–æ–ª—è `x,y,z` —É—Å—Ç–∞—Ä–µ–ª–∏ –∏ –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ `lat, lon`.
- `lastSeenAt` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ `poll`.
- –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø—Ä–∏ `PUT` –æ–Ω–æ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–æ.

---

## –ö–æ–¥—ã –æ—à–∏–±–æ–∫

| –ö–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|----------|
| 200 | –£—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—Ä–æ—Å |
| 204 | –ù–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (–¥–ª—è long-polling) |
| 400 | –ù–µ–≤–µ—Ä–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ |
| 401 | –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø |
| 500 | –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ |

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### JavaScript Client –¥–ª—è Long-Polling

```javascript
class LaserClient {
  constructor(baseUrl, authToken = null) {
    this.baseUrl = baseUrl;
    this.authToken = authToken;
  }

  // –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã
  async sendCommand(device, command) {
    const response = await fetch(`${this.baseUrl}/api/v1/cmd?device=${device}`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        ...(this.authToken && { 'Authorization': `Bearer ${this.authToken}` })
      },
      body: JSON.stringify(command)
    });
    return await response.json();
  }

  // Long-polling –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–π
  async pollEvents(device, cursor = 0, onEvent = null) {
    while (true) {
      try {
        const response = await fetch(
          `${this.baseUrl}/api/v1/poll?device=${device}&cursor=${cursor}&wait=30`
        );
        
        if (response.status === 204) {
          // –ù–µ—Ç –Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π, –ø–æ–≤—Ç–æ—Ä—è–µ–º –∑–∞–ø—Ä–æ—Å
          continue;
        }
        
        if (response.ok) {
          const data = await response.json();
          cursor = data.cursor;
          
          if (onEvent) {
            data.events.forEach(onEvent);
          }
        }
      } catch (error) {
        console.error('Polling error:', error);
        // –ñ–¥—ë–º –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–æ–º
        await new Promise(resolve => setTimeout(resolve, 5000));
      }
    }
  }
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
const client = new LaserClient('http://localhost:8080', 'your-auth-token');

// –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã
client.sendCommand('laser001', { cmd: 'SCENE 1', val: 1 });

// –ó–∞–ø—É—Å–∫ –º–∞–∫—Ä–æ—Å–∞ –≤—ã–∫–ª—é—á–µ–Ω–∏—è
client.sendCommand('laser001', { cmd: 'OFF' });

// –ü—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
client.pollEvents('laser001', 0, (event) => {
  console.log('–ù–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ:', event);
});
```

### cURL –ø—Ä–∏–º–µ—Ä—ã

**–û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã:**
```bash
curl -X POST "http://localhost:8080/api/v1/cmd?device=laser001" \
  -H "Authorization: Bearer your-token" \
  -H "Content-Type: application/json" \
  -d '{"cmd": "SCENE 1", "val": 1}'
```

**Long-polling:**
```bash
curl "http://localhost:8080/api/v1/poll?device=laser001&cursor=0&wait=30"
```

**–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤:**
```bash
curl -H "Authorization: Bearer your-token" \
  "http://localhost:8080/api/v1/devices"
```

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------------|----------|--------------|
| `PORT` | –ü–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞ | 8080 |
| `DB_PATH` | –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö SQLite | `./events.db` |
| `AUTH_TOKEN` | Legacy —Ç–æ–∫–µ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) | –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω |
| `JWT_SECRET` | –°–µ–∫—Ä–µ—Ç –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ JWT | –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤ –ø—Ä–æ–¥–µ |
| `JWT_EXPIRES_IN` | TTL —Ç–æ–∫–µ–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä 24h) | 24h |

### –ü—Ä–∏–º–µ—Ä .env —Ñ–∞–π–ª–∞
```bash
PORT=8080
DB_PATH=./events.db
AUTH_TOKEN=legacy-token-if-needed
JWT_SECRET=your-jwt-secret
JWT_EXPIRES_IN=24h
SCHEDULE_ENABLED=true
SCHEDULE_SCENE_WINDOW=23:00-04:00
SCHEDULE_SCENE_CMD="SCENE 1"
SCHEDULE_OFF_MODE=OFF
SCHEDULE_DEVICES=*
```

---

## –ü–ª–∞–Ω–æ–≤–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ (DB-based Scheduler)

–†–∞—Å–ø–∏—Å–∞–Ω–∏—è —Ç–µ–ø–µ—Ä—å —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ `DeviceSchedule` (Prisma –º–æ–¥–µ–ª—å) –∏ —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ API. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–∫–Ω–∞ –±–µ–∑ —Ä–µ—Å—Ç–∞—Ä—Ç–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

### –ú–æ–¥–µ–ª—å DeviceSchedule
```prisma
model DeviceSchedule {
  id          Int      @id @default(autoincrement())
  deviceId    String?  // null => –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (wildcard)
  windowStart Int      // –º–∏–Ω—É—Ç—ã –æ—Ç –ø–æ–ª—É–Ω–æ—á–∏ 0..1439
  windowEnd   Int      // –º–∏–Ω—É—Ç—ã –æ—Ç –ø–æ–ª—É–Ω–æ—á–∏ 0..1439 (<= start => –æ–∫–Ω–æ —á–µ—Ä–µ–∑ –ø–æ–ª–Ω–æ—á—å)
  sceneCmd    String   @default("SCENE 1")
  offMode     String   @default("OFF")   // OFF | SCENE_OFF
  priority    Int      @default(0)        // –±–æ–ª—å—à–µ = –≤–∞–∂–Ω–µ–µ
  enabled     Boolean  @default(true)
  startTime   String?  // HH:MM (–µ—Å–ª–∏ –∑–∞–¥–∞–Ω–æ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–æ windowStart)
  endTime     String?  // HH:MM (–µ—Å–ª–∏ –∑–∞–¥–∞–Ω–æ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–æ windowEnd)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
```

### –ê–ª–≥–æ—Ä–∏—Ç–º –≤—ã–±–æ—Ä–∞
1. –ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤—Å–µ `enabled` –ø—Ä–∞–≤–∏–ª–∞ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ `priority desc`.
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –ø—Ä–∞–≤–∏–ª (—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ `deviceId` –∏–ª–∏ `deviceId=null`).
3. –ü–µ—Ä–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É —á—å—ë –æ–∫–Ω–æ –∞–∫—Ç–∏–≤–Ω–æ (–º–∏–Ω—É—Ç—ã –ø–æ–ø–∞–¥–∞—é—Ç –≤ –∏–Ω—Ç–µ—Ä–≤–∞–ª) –¥–∞—ë—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ SCENE.
4. –ï—Å–ª–∏ –Ω–∏ –æ–¥–Ω–æ –æ–∫–Ω–æ –∞–∫—Ç–∏–≤–Ω–æ ‚Äî –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è OFF (–∏—Å–ø–æ–ª—å–∑—É—è –ø–µ—Ä–≤–æ–µ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É –ø—Ä–∞–≤–∏–ª–æ –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –Ω–∞—Å—Ç—Ä–æ–µ–∫ `offMode`).
5. –ö–æ–º–∞–Ω–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–º–µ–Ω–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (–∫—ç—à–∏—Ä–æ–≤–∞–Ω–æ –≤ –ø–∞–º—è—Ç–∏).

### –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –æ–∫–Ω–∞
`windowStart=1380 (23:00)`, `windowEnd=240 (04:00)` => –Ω–æ—á–Ω–æ–µ –æ–∫–Ω–æ —á–µ—Ä–µ–∑ –ø–æ–ª–Ω–æ—á—å (–∞–∫—Ç–∏–≤–Ω–æ –µ—Å–ª–∏ `time >= 1380 || time < 240`).

### API (—Ç–æ–ª—å–∫–æ superadmin –¥–ª—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏)
| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------|----------|
| GET | /api/v1/device-schedules | –°–ø–∏—Å–æ–∫ –ø—Ä–∞–≤–∏–ª |
| POST | /api/v1/device-schedules | –°–æ–∑–¥–∞—Ç—å –ø—Ä–∞–≤–∏–ª–æ |
| PUT | /api/v1/device-schedules/:id | –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ |
| DELETE | /api/v1/device-schedules/:id | –£–¥–∞–ª–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ |

### –ü–æ–ª—è —Å–æ–∑–¥–∞–Ω–∏—è / –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
```json
{
  "deviceId": "laser001",   // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, null –∏–ª–∏ –ø—Ä–æ–ø—É—Å–∫ = –¥–ª—è –≤—Å–µ—Ö
  "windowStart": 1380,       // –º–∏–Ω—É—Ç—ã (23*60) ‚Äî fallback –µ—Å–ª–∏ –Ω–µ—Ç startTime
  "windowEnd": 240,          // –º–∏–Ω—É—Ç—ã (4*60) ‚Äî fallback –µ—Å–ª–∏ –Ω–µ—Ç endTime
  "startTime": "23:00",     // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ HH:MM (–ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç windowStart)
  "endTime": "04:00",       // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ HH:MM (–ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç windowEnd)
  "sceneCmd": "SCENE 1",    // —Å—Ç—Ä–æ–∫–∞
  "offMode": "OFF",         // OFF | SCENE_OFF
  "priority": 10,            // —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ (–±–æ–ª—å—à–µ = –≤–∞–∂–Ω–µ–µ)
  "enabled": true
}
```

### –ü—Ä–∏–º–µ—Ä —Å—Ü–µ–Ω–∞—Ä–∏—è
1. –û–±—â–∞—è –Ω–æ—á–Ω–∞—è SCENE 1 –¥–ª—è –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (—á–µ—Ä–µ–∑ HH:MM):
```json
POST /api/v1/device-schedules
{ "startTime": "23:00", "endTime": "04:00", "sceneCmd": "SCENE 1", "priority": 1 }
```
2. –î–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ `laser007` —Å–≤–æ—è SCENE 2 —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º –≤—ã—à–µ:
```json
POST /api/v1/device-schedules
{ "deviceId": "laser007", "startTime": "23:00", "endTime": "04:00", "sceneCmd": "SCENE 2", "priority": 5 }
```
3. –î–Ω–µ–≤–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–∫–ª—é—á–µ–Ω–∏—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ (SCENE_OFF –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞–∫—Ä–æ—Å):
```json
POST /api/v1/device-schedules
{ "startTime": "08:00", "endTime": "17:00", "sceneCmd": "SCENE 1", "offMode": "SCENE_OFF", "priority": 2 }
```

### –ü–æ–≤–µ–¥–µ–Ω–∏–µ OFF
- `OFF`: –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ–ª–Ω—ã–π OFF –º–∞–∫—Ä–æ—Å (–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å).
- `SCENE_OFF`: –æ–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ OFF –±–µ–∑ –º–∞–∫—Ä–æ—Å–∞.

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- –ù–µ—Ç –ø–æ–∫–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–µ–∫—É—â–µ–≥–æ –≤—ã—á–∏—Å–ª–µ–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏).
- –ù–µ—Ç –∞—É–¥–∏—Ç–∞ –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ (—Ç–æ–ª—å–∫–æ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ `[schedule-db]`).

### –í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
- API: `GET /api/v1/device-schedules/status` —Å —Ç–µ–∫—É—â–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∫–∞–∂–¥–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.
- –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î.
- –ù–µ—Å–∫–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ (–∫–æ–º–ø–æ–∑–∏—Ü–∏—è) ‚Äî –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è.

---

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### Long-Polling
- –ö–ª–∏–µ–Ω—Ç—ã –º–æ–≥—É—Ç –∂–¥–∞—Ç—å –Ω–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è –¥–æ 60 —Å–µ–∫—É–Ω–¥
- –ü—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å—Ä–∞–∑—É –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –æ—Ç–≤–µ—Ç
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –æ–¥–Ω–æ–º—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É

### –ú–∞–∫—Ä–æ—Å—ã
- –ö–æ–º–∞–Ω–¥–∞ `OFF` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã–∫–ª—é—á–µ–Ω–∏—è
- –õ—é–±–∞—è –Ω–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ (–∫—Ä–æ–º–µ `GET`) –æ—Ç–º–µ–Ω—è–µ—Ç —Ç–µ–∫—É—â–∏–π –º–∞–∫—Ä–æ—Å
- –ú–∞–∫—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —Å –∑–∞–¥–∞–Ω–Ω—ã–º–∏ –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –°–æ–±—ã—Ç–∏—è –∫—ç—à–∏—Ä—É—é—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ (–¥–æ 500 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–±—ã—Ç–∏–π –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è SQLite —Å WAL —Ä–µ–∂–∏–º–æ–º –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
#### JWT
- –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
- –†–µ–≥—É–ª—è—Ä–Ω–æ —Ä–æ—Ç–∏—Ä—É–π—Ç–µ `JWT_SECRET`
- –ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ –≤ –ª–æ–≥–∞—Ö

#### –ü–∞—Ä–æ–ª–∏
- –•—Ä–∞–Ω—è—Ç—Å—è –≤ –≤–∏–¥–µ bcrypt hash (12 rounds)
- –ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤, –º–∏–Ω–∏–º—É–º 1 –±—É–∫–≤–∞ –∏ 1 —Ü–∏—Ñ—Ä–∞

#### –†–æ–ª–∏
- `admin` ‚Äî –±–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- `superadmin` ‚Äî –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –∏—Ö –ø–∞—Ä–æ–ª—è–º–∏
- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞—â–∏—â–µ–Ω—ã Bearer —Ç–æ–∫–µ–Ω–æ–º
- CORS –≤–∫–ª—é—á–µ–Ω –¥–ª—è –∫—Ä–æ—Å—Å-–¥–æ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ JSON payload (256KB)